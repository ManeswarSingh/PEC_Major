<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plant Easy Care</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400..700&family=Comfortaa:wght@300..700&display=swap" rel="stylesheet">
    <!-- <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400..700&family=Comfortaa:wght@300..700&family=Gloria+Hallelujah&display=swap" rel="stylesheet"> -->
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Reset and Base Styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Poppins', sans-serif;
}

body {
    background-color: #f3f0f0;
    color: white;
}

/* Navigation Bar */
header {
    width: 100%;
    padding: 20px 40px;
    position: absolute;
    top: 0;
    left: 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
}

.logo {
    font-size: 24px;
}

nav ul {
    list-style: none;
    display: flex;
    gap: 20px;
}

nav ul li a {
    text-decoration: none;
    color: white;
    padding: 8px 16px;
    border: 1px solid white;
    border-radius: 25px;
    transition: background 0.3s ease-in-out, color 0.3s ease-in-out;
}
nav ul li a:hover {
    background: white;
    color: #000000; /* Adjust text color for contrast */
}
h1 div{

  font-family: "Caveat", cursive;
  font-optical-sizing: auto;
  font-weight: bold;
  font-size: 200px;
  font-style: normal;

}
h1 span{

  font-family: "Gloria Hallelujah", cursive;
  font-weight: 300;
  font-style: normal;


}

/* Hero Section */
.hero {
    height: 100vh;
    background: url('bg.jpg') no-repeat center center/cover;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
}

.hero h1 {
    font-size: 5rem;
    font-weight: bold;
}

.hero span {
    font-style: italic;
    font-size: 6rem;
    /* color: #007bff; */
}

.hero p {
    font-size: 1.2rem;
    margin-top: 10px;
}

button {
    margin-top: 20px;
    padding: 12px 24px;
    /* background: #007bff; */
    background: none;
    border: 2px solid white;
    color: white;
    font-size: 1.3rem;
    border-radius: 25px;
    cursor: pointer;
    transition: background 0.3s ease-in-out, color 0.3s ease-in-out;
}
button:hover {
    background: white;
    color: #000000; /* Adjust text color for contrast */
}

.community {
    display: flex;
    gap: 20px;
    padding: 20px;
}

.sidebar {
    width: 20%;
    background: #dcead6;
    padding: 20px;
    border-radius: 15px;
}

.sidebar-logo {
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 20px;
}

.sidebar ul {
    list-style: none;
    padding: 0;
}

.sidebar ul li {
    padding: 10px 0;
    font-size: 18px;
    font-weight: bold;
    color: #000;
}
#plantSide{
    font-family: "Caveat", cursive;
  font-optical-sizing: auto;
  font-weight: bold;
  font-size: 60px;
  color: #000;
  font-style: normal;
}
.easy{
    font-family: "Gloria Hallelujah", cursive;
  font-weight: 300;
  color: #000;
  font-style: normal;
}

.connect-btn {
    background: #4caf50;
    color: rgb(63, 58, 58);
    padding: 10px;
    border: none;
    width: 100%;
    border-radius: 5px;
    cursor: pointer;
}

.feed {
    width: 50%;
    background: white;
    padding: 20px;
    border-radius: 15px;
}

.user-info {
    display: flex;
    align-items: center;
    gap: 10px;
}

.user-info input {
    width: 100%;
    padding: 10px;
    border-radius: 5px;
    border: 1px solid #ccc;
}

.tweet {
    /* background: #eef5ea; */
    padding: 15px;
    border-radius: 10px;
    margin-top: 15px;
    color: #000;
}

.tweet img {
    width: 100%;
    border-radius: 10px;
}

.trending {
    width: 20%;
    background: #1a3d24;
    color: white;
    padding: 20px;
    border-radius: 15px;
}

.trending-images img {
    width: 45%;
    margin: 5px;
    border-radius: 10px;
}
.feed {
    width: 50%;
    background: white;
    padding: 20px;
    border-radius: 15px;
    height: 400px; /* Set a fixed height */
    overflow-y: auto; /* Enable vertical scrolling */
    display: flex;
    flex-direction: column;
    gap: 15px;
    box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
}

/* Styling each post */
.tweet {
    /* background: #eef5ea; */
    padding: 15px;
    border-radius: 10px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.tweet img {
    width: 100%;
    border-radius: 10px;
}


.feed-container {
    width: 50%;
}

.post-box {
    background: white;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.post-box input, .post-box textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
}

.post-box button {
    background: #4caf50;
    color: white;
    border: none;
    padding: 10px;
    cursor: pointer;
    border-radius: 5px;
}

.feed {
    margin-top: 20px;
    background: white;
    padding: 15px;
    border-radius: 10px;
    height: 400px; /* Fixed height */
    overflow-y: auto; /* Scrollable */
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.tweet {
    background: #f4f4f4;
    padding: 10px;
    border-radius: 10px;
    margin-bottom: 10px;
}

.tweet small {
    color: gray;
    font-size: 12px;
}

#tweetSection {
    width: 50%;
    margin: auto;
}

#tweetForm {
    background: white;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
    gap: 10px;
}

#tweetForm input, 
#tweetForm textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 16px;
}

#tweetForm textarea {
    resize: none;
    height: 100px;
}

#tweetForm button {
    background: #4caf50;
    color: white;
    border: none;
    padding: 10px;
    cursor: pointer;
    border-radius: 5px;
    font-size: 16px;
    transition: background 0.3s;
}

#tweetForm button:hover {
    background: #388e3c;
}






/* Tweet Form Section */
#tweetSection {
    width: 25%;
    background: white;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
    height: 400px; /* Fixed height */
    overflow-y: auto; /* Scrollable */
}

#tweetForm {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

#tweetForm input,
#tweetForm textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 16px;
}

#tweetForm textarea {
    resize: none;
    height: 100px;
}

#tweetForm button {
    background: #4caf50;
    color: white;
    border: none;
    padding: 10px;
    cursor: pointer;
    border-radius: 5px;
    font-size: 16px;
    transition: background 0.3s;
}

#tweetForm button:hover {
    background: #388e3c;
}

/* Feed Section */
#tweetsContainer {
    width: 50%;
    background: white;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    height: 80vh; /* Large fixed height */
    overflow-y: auto; /* Scrollable */
}

/* Individual Tweet Cards */
.tweet {
    background: #ffffff;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 15px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    font-size: 18px;
}

.tweet small {
    color: gray;
    font-size: 14px;
}






/* Tweet Card Styles */
.tweet {
    background: white;
    padding: 20px;
    border-radius: 15px;
    margin-bottom: 20px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

/* Tweet Header - Profile Image, Name, and Handle */
.tweet-header {
    display: flex;
    align-items: center;
    gap: 10px;
}

/* Profile Image */
.tweet-header img {
    width: 50px;
    height: 50px;
    border-radius: 50%;
}

/* Name and Handle */
.tweet-header .user-info {
    display: flex;
    flex-direction: column;
}

/* Username */
.tweet-header .user-info strong {
    font-size: 18px;
    color: #333;
}

/* User Handle */
.tweet-header .user-info small {
    color: gray;
    font-size: 14px;
}

/* Tweet Content */
.tweet-content {
    font-size: 18px;
    line-height: 1.5;
}

/* Hashtags */
.tweet-content p {
    margin: 10px 0;
    font-weight: bold;
}

/* Tweet Image */
.tweet-image {
    width: 100%;
    border-radius: 10px;
    margin-top: 10px;
}


    </style>
</head>
<body>
    <header>
        <nav>
            <div class="logo">üåø</div>
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="#" onclick="window.location.href = 'model_form.html';">Detect Disease</a></li>

                <li><a href="#">Shop</a></li>
                <li><a href="/user/register">Sign up</a></li>
                <li id="loginLink"><a href="/user/login">Log in</a></li>
            </ul>
        </nav>
    </header>
    
    <section class="hero">
        <h1> <div>Plant</div> <span>Easy Care</span></h1>
        <p>100+ Plants - We want our visitors to be inspired to get their hands dirty.</p>
        <button>Shop Tropical Plants</button>
    </section>
    <section class="community">
        <aside class="sidebar">
            <div class="sidebar-logo"><div id="plantSide">Plant</div> <span class="easy">Easy Care</span></div>
            <ul>
                <li>üè° Home</li>
                <li>üí¨ Message</li>
                <li>üõç ECO Mart</li>
                <li>ü§ñ Grow Bot</li>
            </ul>
            <button class="connect-btn">Connect +</button>
        </aside>
        
        <section id="tweetsContainer">
            <!-- Tweets will be loaded here -->
        </section>
        
        <section id="tweetSection">
            <form id="tweetForm">
                <!-- <input type="text" id="username"> -->
                <textarea id="content" placeholder="Share something..." required></textarea>
                <button type="submit">Post Tweet</button>
            </form>
        </section>

    </section>
    
    <script>
    
document.addEventListener("DOMContentLoaded", async () => {
    const tweetForm = document.getElementById("tweetForm");
    const contentInput = document.getElementById("content");
    const tweetsContainer = document.getElementById("tweetsContainer");
    const loginLink = document.getElementById("loginLink");

    let loggedInUserId = null; // Store logged-in user ID

    // ‚úÖ Fetch login status & update UI
    async function checkLoginStatus() {
        try {
            const response = await fetch("/api/login-status", { credentials: "include" });
            const data = await response.json();

            if (data.isLoggedIn) {
                loggedInUserId = data.userId;
                localStorage.setItem("userId", loggedInUserId);
                loginLink.innerText = "Logout";
                loginLink.href = "#";
                loginLink.onclick = async (event) => {
                    event.preventDefault();
                    if (confirm("Are you sure you want to log out?")) {
                        await fetch("/user/logout", { method: "POST", credentials: "include" });
                        localStorage.removeItem("userId");
                        window.location.reload();
                    }
                };
            } else {
                localStorage.removeItem("userId");
                loginLink.innerText = "Login";
                loginLink.href = "/user/login";
                loginLink.onclick = null;
            }
        } catch (error) {
            console.error("Error fetching login status:", error);
        }
    }

    // ‚úÖ Fetch & Display Tweets
    async function loadTweets() {
    try {
        const response = await fetch("/tweets");
        let tweets = await response.json();

        console.log("Fetched tweets:", tweets);

        tweets = tweets.filter(tweet => tweet.timestamp); // Remove undefined timestamps

        // Ensure timestamps are valid
        tweets.forEach(tweet => {
            if (!tweet.timestamp) tweet.timestamp = "1970-01-01T00:00:00Z"; 
        });

        // Sorting based on timestamp (latest first)
        tweets.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

        console.log("Sorted tweets:", tweets.map(t => t.timestamp));

        tweetsContainer.innerHTML = ""; // Clear previous tweets

        tweets.forEach(tweet => {
            const profileImage = tweet.userId?.profileImage || "https://via.placeholder.com/50";
            const username = tweet.userId?.username || "Unknown User";

            const tweetElement = document.createElement("div");
            tweetElement.classList.add("tweet");

            tweetElement.innerHTML = `
                <div class="tweet-header">
                    <img src="${profileImage}" alt="Profile Picture">
                    <div class="user-info">
                        <strong>${username}</strong>
                        <small>@${username.toLowerCase().replace(/\s+/g, "_")}</small>
                    </div>
                </div>
                <div class="tweet-content">
                    <p>${tweet.content}</p>
                </div>
                ${tweet.image ? `<img src="${tweet.image}" class="tweet-image" alt="Tweet Image">` : ""}
                <small>${new Date(tweet.timestamp).toLocaleString()}</small>
            `;

            tweetsContainer.prepend(tweetElement);
        });
    } catch (error) {
        console.error("Error loading tweets:", error);
    }
}

    // ‚úÖ Post a New Tweet
    tweetForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const content = contentInput.value.trim();

        if (!content) return alert("Tweet cannot be empty!");
        if (!loggedInUserId) return alert("You must be logged in to post a tweet.");

        try {
            const response = await fetch("/tweets", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                credentials: "include",
                body: JSON.stringify({ userId: loggedInUserId, content })
            });

            if (response.ok) {
                contentInput.value = "";
                loadTweets(); // Reload tweets after posting
            } else {
                alert("Failed to post tweet.");
            }
        } catch (error) {
            console.error("Error posting tweet:", error);
        }
    });

    // ‚úÖ Ensure user is logged in before allowing tweets
    await checkLoginStatus();
    if (!loggedInUserId) {
        tweetForm.innerHTML = `<p style="color: red;">You must be logged in to post tweets. <a href="/user/login">Login here</a>.</p>`;
        return;
    }

    loadTweets(); // Load tweets initially
});


    </script>
</body>
</html>
